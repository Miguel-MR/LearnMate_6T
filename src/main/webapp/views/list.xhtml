<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <body>

        <ui:composition template="./TemplateSitio.xhtml">

            <ui:define name="content">
                <h:form id="formGeneral">

                    
                    
                    <!-- ðŸ”˜ Botones DataTables (copiar, excel, etc.) -->
                    <div id="botones-dt"></div>
                    <!-- ðŸ§¾ Tabla de resultados -->
                    <h:panelGroup id="tablaPersonas">
                        <div class="div-table">
                            <div class="div-table-row div-table-head">
                                <div class="div-table-cell">Primer Nombre</div>
                                <div class="div-table-cell">Tipo Documento</div>
                                <div class="div-table-cell">Documento</div>
                                <div class="div-table-cell">Acciones</div>
                            </div>
                            <ui:repeat value="#{controllerPersona.listarPersonas()}" var="item">
                                <div class="div-table-row">
                                    <div class="div-table-cell">#{item.primerNombre}</div>
                                    <div class="div-table-cell">#{item.tipoDocumento}</div>
                                    <div class="div-table-cell">#{item.identificacion}</div>
                                    <div class="div-table-cell">
                                        <td>
                                            <h:link outcome="editar.xhtml" value="âœï¸ Editar" style="margin-right: 1em;">
                                                <f:param name="personaId" value="#{item.personaId}" />
                                            </h:link>
                                            <h:commandLink value="ðŸ—‘ï¸ Eliminar"
                                                           action="#{controllerPersona.eliminarPersona(item)}"
                                                           onclick="return confirm('Â¿Seguro que deseas eliminar esta persona?');" />
                                        </td>
                                    </div>
                                </div>
                            </ui:repeat>
                        </div>


                    </h:panelGroup>
                </h:form>
                <Script>
                    function recargarDataTable() {
                        setTimeout(() => {
                            // Destruir instancia previa si existe
                            if ($.fn.DataTable.isDataTable('#t-all')) {
                                $('#t-all').DataTable().destroy();
                            }
                            const tabla = $('#t-all').DataTable({
                                destroy: true,
                                dom: 'Bfrtip',
                                buttons: ['copy', 'csv', 'excel', 'pdf', 'print'],
                                language: {
                                    url: "https://cdn.datatables.net/plug-ins/1.11.3/i18n/es_es.json"
                                },
                                pageLength: 50
                            });
                            // Insertar los botones encima de la tabla
                            tabla.buttons().container().appendTo('#botones-dt');
                        }, 100);
                    }
                    jsf.ajax.addOnEvent(function (data) {
                        if (data.status === 'success') {
                            recargarDataTable();
                        }
                    });
                    $(document).ready(function () {
                        recargarDataTable();
                    });
                </Script>

                


            </ui:define>

        </ui:composition>

    </body>
    
    
</html>
