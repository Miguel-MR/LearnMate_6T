<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <body>

        <ui:composition template="./TemplateSitio.xhtml">

            <ui:define name="content">
                
                <h:form id="formGeneral" enctype="multipart/form-data">
                    <h:inputFile value="#{controllerUsuario.file}"></h:inputFile>
                    <h:commandButton value="subircsv" action="#{controllerUsuario.procesarUsuariosCsv()}"> </h:commandButton>



                    <!-- 🔘 Botones DataTables (copiar, excel, etc.) -->
                    <div id="botones-dt"></div>
                    <!-- 🧾 Tabla de resultados -->
                    <h:panelGroup id="tablaPersonas">
                        
                        <table id="t-all" class="jsf-data-tables display nowrap" width="100%" border="1">

                            <thead>
                                <tr>
                                    <th class="div-table-cell">Primer Nombre</th>
                                    <th class="div-table-cell">Segundo Nombre</th>
                                    <th class="div-table-cell">Tipo documento</th>
                                    <th class="div-table-cell">Documento</th>
                                    <th class="div-table-cell"></th>
                                </tr>
                            </thead>
                            <tbody>
                                <ui:repeat value="#{controllerPersona.listarPersonas()}" var="item">
                                    <tr>
                                        <td class="div-table-cell">#{item.primerNombre}</td>
                                        <td class="div-table-cell">#{item.segundoNombre}</td>
                                        <td class="div-table-cell">#{item.tipoDocumento}</td>
                                        <td class="div-table-cell">#{item.identificacion}</td>
                                        <td class="div-table-cell">

                                            <h:link outcome="editar.xhtml" value="✏️ Editar" style="margin-right: 1em;">
                                                <f:param name="personaId" value="#{item.personaId}" />
                                            </h:link>
                                            <h:commandLink value="🗑️ Eliminar"
                                                           action="#{controllerPersona.eliminarPersona(item)}"
                                                           onclick="return confirm('¿Seguro que deseas eliminar esta persona?');" />
                                        </td>
                                        
                                    </tr>
                                </ui:repeat>

                            </tbody>
                        </table>
                        <h:messages globalOnly="true" layout="table" />




                    </h:panelGroup>
                </h:form>
                <script>
                    $('.jsf-data-tables').DataTable({
                    dom: 'Bfrtip',
                            language: {
                            url: "https://cdn.datatables.net/plug-ins/1.11.3/i18n/es_es.json"
                            },
                            pageLength: 50,
                            buttons: [
                            {
                            extend: 'copy',
                                    text: 'Copiar',
                                    className: 'btn btn-copy',
                                    exportOptions: {
                                    columns: [0, 1, 2]
                                    }
                            },
                            {
                            extend: 'csv',
                                    text: 'CSV',
                                    className: 'btn btn-info',
                                    exportOptions: {
                                    columns: [0, 1, 2]
                                    }
                            },
                            {
                            extend: 'excel',
                                    text: 'Excel',
                                    className: 'btn btn-success',
                                    exportOptions: {
                                    columns: [0, 1, 2]
                                    }
                            },
                            {
                            extend: 'pdf',
                                    text: 'PDF',
                                    className: 'btn btn-danger',
                                    exportOptions: {
                                    columns: [0, 1, 2]
                                    },
                                    customize: function (doc) {
                                    doc.pageMargins = [20, 20, 20, 20];
                                    doc.defaultStyle.fontSize = 10;
                                    doc.styles.tableHeader.fontSize = 12;
                                    }
                            },
                            {
                            extend: 'print',
                                    text: 'Imprimir',
                                    className: 'btn btn-imp',
                                    exportOptions: {
                                    columns: [0, 1, 2]
                                    }
                            }
                               ]
                        });           
                </script>




            </ui:define>

        </ui:composition>

    </body>


</html>
